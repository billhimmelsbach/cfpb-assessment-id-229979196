'''Tests the main.py script with unit and e2e tests'''

import subprocess
import json
import requests_mock

expected_users: list = ["18207056982152612516", "7692335473348482352", "6944230214351225668",
                        "3628386513825310392", "8189326092454270383", "12257150257418962584",
                        "15245671842903013860", "6123808318520183820", "2369758755179393951",
                        "11199617667907522182", "17679958362462205107", "8161384308545570741",
                        "17905933069300437710", "2128366919142314320", "8050198496000226474",
                        "12285596562078846341", "17498264813380685804", "15878820492083617521",
                        "13852292911651453672", "17337865973615628454", "9229455752287942842",
                        "7276261224779907663", "1739512995212175590", "8755001447812608547",
                        "12490857963551106851", "11361123386737171544", "9568729738456525675",
                        "7299386991593269749", "10786704641810476266", "5473944502633417925",
                        "14253488556059378189", "14319538188300915189", "4660829384912539755",
                        "661873756344312272", "9084860398647086882", "6471708071048854006",
                        "4322572609509483582", "12344026228624416837", "12374588821574841291",
                        "8920530543498641549", "12124692496822977637", "12524470487343793064",
                        "15760024072391938219", "16504973638458783072", "13653696933022620424",
                        "12631380398739473811", "5704443017213828170", "5553955800590348530",
                        "16243288493962424038", "8556936092924245870", "14091093140311075469",
                        "3814133641198355037", "7637672811351545355", "4075283707084492266",
                        "15803548898562307514", "17108377201160133721", "5413190493951543960",
                        "16350041139552811629", "3785541205673408781", "6052895740344310564",
                        "9986143740894816983", "3374252707548930643", "8297434677357993039",
                        "4322836435026298260"]
expected_stdout = json.dumps(expected_users)


def test_main_script():
    requests_mock.real_http = True
    '''integration test to ensure the script returns expected stdout'''
    stdout = subprocess.run(['python', 'main.py'],
                            check=True, capture_output=True, text=True).stdout

    assert stdout == expected_stdout
